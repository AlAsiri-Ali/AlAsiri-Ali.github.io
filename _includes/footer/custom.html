<!-- start custom footer snippets -->

<!-- Load dual theme CSS -->
<link rel="stylesheet" href="{{ '/assets/css/dual-theme.css' | relative_url }}">

<!-- Theme toggle button styles -->
<style>
  /* Smart theme toggle button with auto-hide functionality */
  .theme-toggle-btn {
    position: fixed;
    bottom: 80px;
    right: 20px;
    background: #007acc;
    color: white;
    border: none;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    font-size: 22px;
    cursor: pointer;
    z-index: 9999 !important;
    transition: all 0.5s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    display: flex !important;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transform: scale(1);
  }
  
  /* Auto-hide state - more visible but not intrusive */
  .theme-toggle-btn.auto-hide {
    opacity: 0.3;
    transform: scale(0.85);
    pointer-events: auto; /* Still clickable */
  }
  
  .theme-toggle-btn:hover,
  .theme-toggle-btn:focus {
    opacity: 1 !important;
    transform: scale(1.15) !important;
    background: #005a9e !important;
  }
  
  .theme-toggle-btn.show-temporary {
    opacity: 1 !important;
    transform: scale(1) !important;
  }

  body.theme-dark .theme-toggle-btn {
    background: #00adb5;
  }

  body.theme-dark .theme-toggle-btn:hover,
  body.theme-dark .theme-toggle-btn:focus,
  body.theme-dark .theme-toggle-btn.show-temporary {
    background: #4db6ac !important;
  }
  
  /* Mobile screens */
  @media (max-width: 768px) {
    .theme-toggle-btn {
      bottom: 100px;
      right: 15px;
      width: 55px;
      height: 55px;
      font-size: 22px;
    }
    
    /* More visible on mobile but still subtle */
    .theme-toggle-btn.auto-hide {
      opacity: 0.4;
      transform: scale(0.9);
    }
    
    /* Show clearly on direct touch */
    .theme-toggle-btn:active {
      opacity: 1 !important;
      transform: scale(1.2) !important;
    }
  }
  
  @media (max-width: 480px) {
    .theme-toggle-btn {
      bottom: 90px;
      right: 10px;
      width: 50px;
      height: 50px;
      font-size: 20px;
    }
  }
  
  /* Much larger touch area for mobile */
  @media (max-width: 768px) {
    .theme-toggle-btn::before {
      content: '';
      position: absolute;
      top: -15px;
      left: -15px;
      right: -15px;
      bottom: -15px;
      z-index: -1;
      border-radius: 50%;
    }
  }
</style>

<!-- Smart theme toggle button with auto-hide -->
<button class="theme-toggle-btn" id="theme-toggle-btn" title="Toggle Theme">
  🌙
</button>

<script>
let hideTimer;
let isUserActive = false;
let scrollTimer;

function toggleTheme() {
  const body = document.body;
  const button = document.getElementById('theme-toggle-btn');
  
  if (body.classList.contains('theme-dark')) {
    body.classList.remove('theme-dark');
    button.innerHTML = '🌙';
    localStorage.setItem('website-theme', 'light');
  } else {
    body.classList.add('theme-dark');
    button.innerHTML = '☀️';
    localStorage.setItem('website-theme', 'dark');
  }
  
  // Show button temporarily after click
  showButtonTemporarily();
}

function showButtonTemporarily() {
  const button = document.getElementById('theme-toggle-btn');
  if (!button) return;
  
  // Clear any previous timer
  clearTimeout(hideTimer);
  
  // Show button
  button.classList.remove('auto-hide');
  button.classList.add('show-temporary');
  
  // Hide button after 5 seconds instead of 2
  hideTimer = setTimeout(() => {
    button.classList.remove('show-temporary');
    button.classList.add('auto-hide');
  }, 5000);
}

function hideButtonForcefully() {
  const button = document.getElementById('theme-toggle-btn');
  if (!button) return;
  
  clearTimeout(hideTimer);
  button.classList.remove('show-temporary');
  button.classList.add('auto-hide');
}

// Load saved theme
(function() {
  const savedTheme = localStorage.getItem('website-theme');
  if (savedTheme === 'dark') {
    document.body.classList.add('theme-dark');
  }
})();

// Update button when ready
function updateButton() {
  const savedTheme = localStorage.getItem('website-theme');
  const button = document.getElementById('theme-toggle-btn');
  
  if (button) {
    button.innerHTML = savedTheme === 'dark' ? '☀️' : '🌙';
    button.addEventListener('click', toggleTheme);
    
    // Show only on direct button hover
    button.addEventListener('mouseenter', () => {
      clearTimeout(hideTimer);
      button.classList.remove('auto-hide');
      button.classList.add('show-temporary');
    });
    
    button.addEventListener('mouseleave', () => {
      // Don't hide immediately, wait a bit
      setTimeout(() => {
        hideButtonForcefully();
      }, 1000);
    });
    
    // Mobile - show on direct touch only
    button.addEventListener('touchstart', (e) => {
      e.preventDefault();
      showButtonTemporarily();
    });
    
    // Start auto-hide after page load
    setTimeout(() => {
      button.classList.add('auto-hide');
    }, 1500);
    
    // Force hide every 10 seconds instead of 5
    setInterval(() => {
      if (!button.matches(':hover')) {
        hideButtonForcefully();
      }
    }, 10000);
  }
}

// Show button only when approaching bottom-right corner
function handleMouseMove(e) {
  const windowWidth = window.innerWidth;
  const windowHeight = window.innerHeight;
  
  // Very small area - only 120px from corner
  const isInTriggerZone = (
    e.clientX > windowWidth - 120 && 
    e.clientY > windowHeight - 180
  );
  
  if (isInTriggerZone) {
    showButtonTemporarily();
  }
}

// Less aggressive scroll hiding
function handleScroll() {
  clearTimeout(scrollTimer);
  
  // Don't hide immediately on scroll, just delay showing
  scrollTimer = setTimeout(() => {
    // Allow showing again after scroll stops
  }, 500);
}

// Initialize everything
function initializeThemeToggle() {
  updateButton();
  
  // Mouse listener - very small area only
  document.addEventListener('mousemove', handleMouseMove);
  
  // Hide on scroll
  document.addEventListener('scroll', handleScroll);
  
  // Mobile - larger touch area for easier access
  document.addEventListener('touchstart', (e) => {
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    const touch = e.touches[0];
    
    // Larger area - 150px from corner for easier mobile use
    if (touch.clientX > windowWidth - 150 && 
        touch.clientY > windowHeight - 200) {
      showButtonTemporarily();
    }
  });
}

// Run on page load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeThemeToggle);
} else {
  initializeThemeToggle();
}

// Safety backup - run only once
setTimeout(() => {
  initializeThemeToggle();
  
  // Force hide after loading
  setTimeout(() => {
    hideButtonForcefully();
  }, 2000);
}, 500);
</script>

<!-- end custom footer snippets -->
